<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Model Fine-Tuning - Hackathon {Tech: Europe}</title>
    
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary-color: #64748b;
            --accent-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-color) 0%, #e2e8f0 100%);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .header {
            background: var(--card-bg);
            border-bottom: 2px solid var(--primary-color);
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: var(--primary-color);
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .grid {
            display: grid;
            gap: 2rem;
            grid-template-columns: 1fr 1fr;
        }
        
        .section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }
        
        .section h2 {
            color: var(--primary-color);
            font-size: 1.3rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--secondary-color);
        }
        
        .status-indicator.active {
            background: var(--accent-color);
        }
        
        .status-indicator.error {
            background: var(--error-color);
        }
        
        .status-indicator.training {
            background: var(--warning-color);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }
        
        .btn-accent {
            background: var(--accent-color);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning-color);
            color: white;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .output {
            background: #1e293b;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 1rem;
        }
        
        .metric-card {
            background: var(--bg-color);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            text-align: center;
            margin-bottom: 1rem;
        }
        
        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .metric-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .comparison-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .model-response {
            background: var(--bg-color);
            border-radius: 8px;
            padding: 1rem;
            border: 2px solid var(--border-color);
        }
        
        .model-response.generic {
            border-color: var(--secondary-color);
        }
        
        .model-response.fine-tuned {
            border-color: var(--accent-color);
        }
        
        .model-response h3 {
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        
        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 1rem;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: var(--primary-color);
            background: var(--bg-color);
        }
        
        .upload-area.active {
            border-color: var(--accent-color);
            background: var(--bg-color);
        }
        
        .document-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }
        
        .document-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: var(--bg-color);
            margin-bottom: 0.5rem;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .comparison-area {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 0 1rem;
            }
            
            .header {
                padding: 1rem;
            }
        }
        
        .alert {
            padding: 0.75rem 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .alert-info {
            background: #dbeafe;
            border: 1px solid #93c5fd;
            color: #1e40af;
        }
        
        .alert-warning {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            color: #92400e;
        }
        
        .alert-success {
            background: #d1fae5;
            border: 1px solid #34d399;
            color: #065f46;
        }
        
        .training-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .architecture-diagram {
            text-align: center;
            padding: 1rem;
            background: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .pipeline-step {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: var(--primary-color);
            color: white;
            border-radius: 20px;
            margin: 0.25rem;
            font-size: 0.8rem;
        }
        
        .arrow {
            display: inline-block;
            margin: 0 0.5rem;
            color: var(--text-secondary);
        }
        
        .input-group {
            margin-bottom: 1rem;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .input-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: inherit;
            resize: vertical;
            min-height: 80px;
        }
        
        .input-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ü§ñ Local Model Fine-Tuning</h1>
        <p>Hackathon {Tech: Europe} September 13-14th 2025 ‚Ä¢ Organizational AI Customization with LoRA</p>
    </div>

    <div class="container">
        <div class="alert alert-info">
            <span>‚ÑπÔ∏è</span>
            <span>Upload organizational documents to fine-tune a local AI model that understands your company's values and strategy.</span>
        </div>

        <div class="grid">
            <!-- Document Upload -->
            <div class="section">
                <h2><span class="status-indicator" id="upload-status"></span>Document Upload</h2>
                
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìÑ</div>
                    <div>Click to upload organizational documents</div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">
                        Supports: PDF, DOCX, TXT, MD
                    </div>
                    <input type="file" id="fileInput" multiple accept=".pdf,.docx,.txt,.md" style="display: none;">
                </div>
                
                <div class="document-list" id="documentList">
                    <!-- Uploaded documents will appear here -->
                </div>

                <!-- Organizational Training Examples -->
                <div style="border: 1px solid var(--accent-color); border-radius: 8px; padding: 1rem; margin: 1rem 0; background: linear-gradient(135deg, #f0f8ff 0%, #e8f5e8 100%);">
                    <h3 style="color: var(--accent-color); margin-bottom: 0.75rem;">ü§ñ Organizational Training Dataset</h3>
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">Pre-prepared training examples covering organizational strategy, values, and decision-making. Click to add for fine-tuning:</p>

                    <div id="wellnessroberts-documents" style="display: grid; gap: 0.5rem;">
                        <!-- Training examples will be loaded here -->
                    </div>

                    <button class="btn btn-accent" onclick="loadWellnessRobertsDocuments()" style="margin-top: 0.75rem;">üìã Load Training Examples</button>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" onclick="processDocuments()">üìä Process Documents</button>
                    <button class="btn btn-secondary" onclick="clearDocuments()">üóëÔ∏è Clear All</button>
                </div>

                <div class="metric-card">
                    <div class="metric-value" id="document-count">0</div>
                    <div class="metric-label">Documents Uploaded</div>
                </div>
            </div>

            <!-- Fine-Tuning Pipeline -->
            <div class="section">
                <h2><span class="status-indicator" id="training-status"></span>Fine-Tuning Pipeline</h2>

                <div class="input-group">
                    <label for="baseModel">Base Model Selection:</label>
                    <select id="baseModel" style="width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 6px; font-family: inherit;">
                        <option value="llama2:13b-chat">Llama 2 13B Chat (Default)</option>
                        <option value="mistral:7b">Mistral 7B (Efficient)</option>
                        <option value="qwen2.5:3b">Qwen 2.5 3B (Lightweight)</option>
                    </select>
                </div>

                <div class="architecture-diagram">
                    <div>
                        <span class="pipeline-step">Document Processing</span>
                        <span class="arrow">‚Üí</span>
                        <span class="pipeline-step">Training Data Generation</span>
                    </div>
                    <div style="margin-top: 0.5rem;">
                        <span class="arrow">‚Üì</span>
                    </div>
                    <div>
                        <span class="pipeline-step">LoRA Fine-tuning</span>
                        <span class="arrow">‚Üí</span>
                        <span class="pipeline-step">Model Deployment</span>
                    </div>
                </div>

                <div class="training-metrics">
                    <div class="metric-card">
                        <div class="metric-value" id="training-examples">0</div>
                        <div class="metric-label">Training Examples</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="training-time">0m</div>
                        <div class="metric-label">Training Time</div>
                    </div>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="training-progress"></div>
                </div>

                <div class="controls">
                    <button class="btn btn-warning" onclick="startFineTuning()">üöÄ Start Fine-Tuning</button>
                    <button class="btn btn-secondary" onclick="stopTraining()">‚èπÔ∏è Stop Training</button>
                </div>

                <div class="output" id="training-output">Ready to start fine-tuning...</div>
            </div>

            <!-- Model Comparison -->
            <div class="section">
                <h2><span class="status-indicator active"></span>Model Comparison</h2>

                <div class="alert alert-warning">
                    <span>‚ö†Ô∏è</span>
                    <span><strong>Demo Mode:</strong> This demo uses hardcoded responses that simulate what fine-tuned models would produce. Real LLM execution would require running Ollama with the actual models.</span>
                </div>
                
                <div class="input-group">
                    <label for="testQuery">Test Query:</label>
                    <textarea id="testQuery" placeholder="Ask a question about strategy, values, or decision-making...">How should we approach our next strategic initiative?</textarea>
                </div>
                
                <div class="controls">
                    <button class="btn btn-primary" onclick="compareModels()">‚öñÔ∏è Compare Models</button>
                    <button class="btn btn-accent" onclick="loadSampleQuestions()">üí° Load Sample Questions</button>
                </div>

                <div class="comparison-area">
                    <div class="model-response generic">
                        <h3>ü§ñ Generic AI Response</h3>
                        <div id="generic-response">Ask a question to see generic AI response...</div>
                    </div>
                    <div class="model-response fine-tuned">
                        <h3>üè¢ Organization-Tuned AI Response</h3>
                        <div id="tuned-response">Fine-tune your model first to see customized responses...</div>
                    </div>
                </div>
            </div>

            <!-- System Status -->
            <div class="section">
                <h2><span class="status-indicator" id="system-status"></span>System Status</h2>
                
                <div class="metric-card">
                    <div class="metric-value" id="model-size">13GB</div>
                    <div class="metric-label">Base Model Size</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-value" id="lora-size">0MB</div>
                    <div class="metric-label">LoRA Adapter Size</div>
                </div>

                <div class="metric-card">
                    <div class="metric-value" id="build-time">-</div>
                    <div class="metric-label">Estimated Build Time</div>
                </div>

                <div class="metric-card">
                    <div class="metric-value" id="inference-time">-</div>
                    <div class="metric-label">Inference Time</div>
                </div>

                <div class="metric-card">
                    <div class="metric-value" id="memory-usage">-</div>
                    <div class="metric-label">Memory Usage</div>
                </div>

                <div class="controls">
                    <button class="btn btn-secondary" onclick="checkSystemHealth()">üè• Health Check</button>
                    <button class="btn btn-secondary" onclick="viewLogs()">üìã View Logs</button>
                </div>

                <div class="alert" id="system-alert" style="display: none;">
                    <span>‚ö†Ô∏è</span>
                    <span>System status information will appear here</span>
                </div>
            </div>
        </div>

        <!-- Full-width sections -->
        <div class="section full-width">
            <h2>üéØ About Local Model Fine-Tuning</h2>
            <p style="margin-bottom: 1rem;">
                This demo showcases how to customize large language models using LoRA (Low-Rank Adaptation) 
                fine-tuning with organizational documents. The system processes your company's strategic documents, 
                generates training examples, and creates a specialized AI that understands your organizational context.
            </p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                <div style="padding: 1rem; background: var(--bg-color); border-radius: 8px;">
                    <h3>üìã Document Processing</h3>
                    <p>Upload and process organizational documents including policies, values, and strategic plans to create training data.</p>
                </div>
                
                <div style="padding: 1rem; background: var(--bg-color); border-radius: 8px;">
                    <h3>‚öôÔ∏è LoRA Fine-Tuning</h3>
                    <p>Use efficient Low-Rank Adaptation to customize the model without requiring massive computational resources.</p>
                </div>
                
                <div style="padding: 1rem; background: var(--bg-color); border-radius: 8px;">
                    <h3>üè† Local Deployment</h3>
                    <p>Run everything locally using Ollama for privacy and control over your organizational data and AI models.</p>
                </div>
                
                <div style="padding: 1rem; background: var(--bg-color); border-radius: 8px;">
                    <h3>‚öñÔ∏è Response Comparison</h3>
                    <p>Compare generic AI responses with organization-specific responses to see the impact of fine-tuning.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let uploadedDocuments = [];
        let isTraining = false;
        let trainingInterval = null;
        let modelFineTuned = false;
        let selectedBaseModel = 'llama2:13b-chat';

        // Model configurations
        const modelConfigs = {
            'llama2:13b-chat': {
                name: 'Llama 2 13B Chat',
                size: '13GB',
                params: '13B',
                efficiency: 'Standard',
                description: 'High quality responses, good for complex tasks',
                buildTime: '2.5 hours',
                loraSize: '52MB',
                inferenceTime: '850ms',
                accuracy: '92%',
                memoryUsage: '18GB'
            },
            'mistral:7b': {
                name: 'Mistral 7B',
                size: '7GB',
                params: '7B',
                efficiency: 'Efficient',
                description: 'Fast inference, good performance/efficiency balance',
                buildTime: '1.2 hours',
                loraSize: '28MB',
                inferenceTime: '425ms',
                accuracy: '89%',
                memoryUsage: '12GB'
            },
            'qwen2.5:3b': {
                name: 'Qwen 2.5 3B',
                size: '3GB',
                params: '3B',
                efficiency: 'Lightweight',
                description: 'Fastest inference, suitable for quick responses',
                buildTime: '35 minutes',
                loraSize: '12MB',
                inferenceTime: '180ms',
                accuracy: '85%',
                memoryUsage: '6GB'
            }
        };

        // Model selection handling
        document.getElementById('baseModel').addEventListener('change', function(e) {
            selectedBaseModel = e.target.value;
            const modelConfig = modelConfigs[selectedBaseModel];

            // Update all model metrics display
            document.getElementById('model-size').textContent = modelConfig.size;
            document.getElementById('build-time').textContent = modelConfig.buildTime;
            document.getElementById('inference-time').textContent = modelConfig.inferenceTime;
            document.getElementById('memory-usage').textContent = modelConfig.memoryUsage;

            logMessage(`üîÑ Selected base model: ${modelConfig.name} (${modelConfig.params} parameters)`);
            logMessage(`üìã ${modelConfig.description}`);
            logMessage(`‚ö° Build time: ${modelConfig.buildTime} | Inference: ${modelConfig.inferenceTime} | Memory: ${modelConfig.memoryUsage}`);

            // Reset training state when model changes
            modelFineTuned = false;
            document.getElementById('lora-size').textContent = '0MB';
        });

        // File upload handling
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            files.forEach(file => {
                if (!uploadedDocuments.find(doc => doc.name === file.name)) {
                    uploadedDocuments.push({
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        uploaded: new Date().toISOString()
                    });
                }
            });
            updateDocumentList();
            updateDocumentCount();
        });

        function updateDocumentList() {
            const listElement = document.getElementById('documentList');
            listElement.innerHTML = '';
            
            uploadedDocuments.forEach((doc, index) => {
                const item = document.createElement('div');
                item.className = 'document-item';
                item.innerHTML = `
                    <span>${doc.name} (${formatFileSize(doc.size)})</span>
                    <button class="btn" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;" onclick="removeDocument(${index})">√ó</button>
                `;
                listElement.appendChild(item);
            });

            document.getElementById('upload-status').className = uploadedDocuments.length > 0 ? 'status-indicator active' : 'status-indicator';
        }

        function updateDocumentCount() {
            document.getElementById('document-count').textContent = uploadedDocuments.length;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function removeDocument(index) {
            uploadedDocuments.splice(index, 1);
            updateDocumentList();
            updateDocumentCount();
        }

        function clearDocuments() {
            uploadedDocuments = [];
            updateDocumentList();
            updateDocumentCount();
            logMessage('Cleared all documents');
        }

        async function processDocuments() {
            if (uploadedDocuments.length === 0) {
                alert('Please upload documents first');
                return;
            }

            logMessage('Processing documents...');
            
            try {
                const response = await fetch('/process-documents', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ documents: uploadedDocuments })
                });

                const result = await response.json();
                if (result.success) {
                    document.getElementById('training-examples').textContent = result.training_examples || (uploadedDocuments.length * 25);
                    logMessage(`Generated ${result.training_examples || (uploadedDocuments.length * 25)} training examples`);
                } else {
                    logMessage(`Error: ${result.message}`);
                }
            } catch (error) {
                // Mock processing for demo
                const trainingExamples = uploadedDocuments.length * 25;
                document.getElementById('training-examples').textContent = trainingExamples;
                logMessage(`Processed ${uploadedDocuments.length} documents`);
                logMessage(`Generated ${trainingExamples} training examples`);
                
                setTimeout(() => {
                    logMessage('Document processing complete - ready for fine-tuning');
                }, 1000);
            }
        }

        async function startFineTuning() {
            if (uploadedDocuments.length === 0) {
                alert('Please upload and process documents first');
                return;
            }

            if (isTraining) {
                alert('Training already in progress');
                return;
            }

            isTraining = true;
            modelFineTuned = false;
            document.getElementById('training-status').className = 'status-indicator training';
            document.getElementById('training-output').textContent = '';
            
            const modelConfig = modelConfigs[selectedBaseModel];
            logMessage('üöÄ Starting LoRA fine-tuning...');
            logMessage(`Loading base model (${modelConfig.name})...`);
            
            let progress = 0;
            let startTime = Date.now();
            
            trainingInterval = setInterval(() => {
                progress += Math.random() * 5;
                if (progress > 100) progress = 100;
                
                document.getElementById('training-progress').style.width = progress + '%';
                
                const elapsedMinutes = Math.floor((Date.now() - startTime) / 60000);
                document.getElementById('training-time').textContent = elapsedMinutes + 'm';
                
                // Training phases
                if (progress < 20) {
                    if (Math.random() < 0.3) logMessage('Initializing LoRA adapters...');
                } else if (progress < 40) {
                    if (Math.random() < 0.2) logMessage('Training epoch 1/3...');
                } else if (progress < 70) {
                    if (Math.random() < 0.2) logMessage('Training epoch 2/3...');
                } else if (progress < 90) {
                    if (Math.random() < 0.2) logMessage('Training epoch 3/3...');
                } else if (progress >= 100 && isTraining) {
                    clearInterval(trainingInterval);
                    isTraining = false;
                    modelFineTuned = true;
                    document.getElementById('training-status').className = 'status-indicator active';

                    // Set LoRA size based on selected model
                    const modelConfig = modelConfigs[selectedBaseModel];
                    document.getElementById('lora-size').textContent = modelConfig.loraSize;

                    logMessage('‚úÖ Fine-tuning completed successfully!');
                    logMessage(`üíæ LoRA adapter saved: ${modelConfig.loraSize}`);
                    logMessage(`üéØ Model accuracy: ${modelConfig.accuracy}`);
                    logMessage('üöÄ Ready for inference with organizational knowledge');

                    showAlert('success', 'Model fine-tuning completed! You can now compare responses.');
                }
            }, 200);
        }

        function stopTraining() {
            if (trainingInterval) {
                clearInterval(trainingInterval);
                isTraining = false;
                document.getElementById('training-status').className = 'status-indicator error';
                logMessage('‚èπÔ∏è Training stopped by user');
            }
        }

        async function compareModels() {
            const query = document.getElementById('testQuery').value.trim();
            if (!query) {
                alert('Please enter a test query');
                return;
            }

            const modelConfig = modelConfigs[selectedBaseModel];

            // Generic response with timing
            document.getElementById('generic-response').textContent = 'Generating generic response...';
            const genericStartTime = Date.now();

            setTimeout(() => {
                const genericResponse = getGenericResponse(query);
                const genericTime = Date.now() - genericStartTime;
                document.getElementById('generic-response').innerHTML = `
                    <div style="margin-bottom: 0.5rem; font-size: 0.8rem; color: var(--text-secondary);">‚è±Ô∏è Simulated inference: ${genericTime}ms (Generic AI)</div>
                    ${genericResponse}
                `;
            }, 600); // Simulate faster generic response

            // Tuned response with timing
            document.getElementById('tuned-response').textContent = modelFineTuned ? 'Generating organization-specific response...' : 'Please fine-tune the model first';

            if (modelFineTuned) {
                const tunedStartTime = Date.now();
                setTimeout(() => {
                    const tunedResponse = getTunedResponse(query);
                    const actualInferenceTime = modelConfig.inferenceTime;
                    document.getElementById('tuned-response').innerHTML = `
                        <div style="margin-bottom: 0.5rem; font-size: 0.8rem; color: var(--text-secondary);">‚ö° Simulated ${modelConfig.name} inference: ${actualInferenceTime} (Organization-tuned)</div>
                        ${tunedResponse}
                    `;
                }, parseInt(modelConfig.inferenceTime)); // Use model-specific timing
            }
        }

        function getGenericResponse(query) {
            const responses = {
                "strategic": "To approach strategic initiatives, consider conducting thorough market analysis, engaging stakeholders, evaluating ROI potential, and developing a phased implementation plan with clear success metrics.",
                "decision": "For effective decision-making, gather relevant data, consider multiple perspectives, evaluate risks and benefits, consult with key stakeholders, and establish clear criteria for success.",
                "values": "Organizational values should guide decision-making by providing a framework for ethical conduct, employee behavior, and business practices that align with company culture and objectives.",
                "default": "This requires careful consideration of various factors including resources, timeline, stakeholder impact, and alignment with business objectives. A structured approach with clear milestones would be recommended."
            };

            const lowerQuery = query.toLowerCase();
            if (lowerQuery.includes('strategic') || lowerQuery.includes('initiative')) return responses.strategic;
            if (lowerQuery.includes('decision') || lowerQuery.includes('decide')) return responses.decision;
            if (lowerQuery.includes('value') || lowerQuery.includes('culture')) return responses.values;
            return responses.default;
        }

        function getTunedResponse(query) {
            if (!modelFineTuned) return 'Model not yet fine-tuned';

            const lowerQuery = query.toLowerCase();

            // Check if the query matches any of our organizational training examples
            const matchingExample = organizationalTrainingExamples.find(example =>
                example.instruction.toLowerCase().includes(lowerQuery) ||
                lowerQuery.includes(example.instruction.toLowerCase()) ||
                (example.instruction.toLowerCase() === lowerQuery)
            );

            if (matchingExample) {
                return matchingExample.response;
            }

            // Generic organizational responses based on training themes
            const responses = {
                "strategic": "Our digital transformation strategy focuses on customer-centric innovation, leveraging cloud-first architecture and data-driven decision making. We prioritize agile methodologies and cross-functional collaboration to deliver scalable solutions that enhance operational efficiency while maintaining our commitment to excellence and sustainable growth.",
                "decision": "Our prioritization framework evaluates initiatives based on strategic alignment, resource requirements, expected ROI, and implementation timeline. We use a scoring matrix considering customer impact, competitive advantage, and organizational capability. Regular reviews ensure agility in responding to market changes while maintaining focus on long-term objectives.",
                "values": "Our core values manifest through customer obsession, operational excellence, and team empowerment. We demonstrate integrity in every decision, embrace innovation as a growth driver, and maintain accountability at all levels. These values guide our hiring, promotion, and strategic decisions, ensuring consistent culture across all business units.",
                "innovation": "Innovation thrives through dedicated time allocation, cross-team collaboration, and failure tolerance. We support experimentation with allocated resources, encourage diverse perspectives, and maintain open innovation channels. Regular innovation sessions, external partnerships, and customer feedback loops drive continuous improvement and breakthrough thinking.",
                "risk": "Our risk management framework balances opportunity assessment with prudent controls. We conduct comprehensive market analysis, pilot programs, and scenario planning. Key considerations include regulatory compliance, competitive landscape, resource allocation, and potential impact on existing operations.",
                "talent": "We believe in developing talent through challenging assignments, mentorship programs, and continuous learning opportunities. Our approach includes 360-degree feedback, cross-functional rotations, and leadership development tracks. We invest in both technical skills and leadership capabilities, fostering a culture of growth mindset and knowledge sharing.",
                "crisis": "Immediate activation of our crisis response team with clear communication channels and decision authority. Priority one is ensuring stakeholder safety and business continuity. We follow established communication protocols with transparent, timely updates to customers, employees, and partners.",
                "default": "Based on our organizational values of customer obsession, operational excellence, and innovation, we approach this through our established framework of strategic alignment, cross-functional collaboration, and data-driven decision making. This ensures consistency with our core principles and long-term objectives."
            };

            if (lowerQuery.includes('strategic') || lowerQuery.includes('initiative')) return responses.strategic;
            if (lowerQuery.includes('decision') || lowerQuery.includes('decide')) return responses.decision;
            if (lowerQuery.includes('value') || lowerQuery.includes('culture')) return responses.values;
            if (lowerQuery.includes('innovation') || lowerQuery.includes('foster')) return responses.innovation;
            if (lowerQuery.includes('risk') || lowerQuery.includes('management')) return responses.risk;
            if (lowerQuery.includes('talent') || lowerQuery.includes('development')) return responses.talent;
            if (lowerQuery.includes('crisis') || lowerQuery.includes('emergency')) return responses.crisis;
            return responses.default;
        }

        function loadSampleQuestions() {
            const organizationalQueries = organizationalTrainingExamples.map(example => example.instruction);

            const genericQueries = [
                "How should we approach our next strategic initiative?",
                "What factors should guide our decision-making process?",
                "How do our company values influence our business strategy?",
                "What's the best way to handle organizational change?",
                "How should we prioritize our quarterly objectives?"
            ];

            // Prefer organizational training queries if available
            const queries = organizationalQueries.length > 0 ? organizationalQueries : genericQueries;
            const randomSample = queries[Math.floor(Math.random() * queries.length)];
            document.getElementById('testQuery').value = randomSample;
        }

        async function checkSystemHealth() {
            document.getElementById('system-status').className = 'status-indicator active';
            showAlert('info', 'System health check passed - all services running normally');
        }

        function viewLogs() {
            logMessage('=== SYSTEM LOGS ===');
            logMessage('Ollama service: Running');
            logMessage('LoRA training pipeline: Ready');
            logMessage('Document processor: Online');
            logMessage('Model inference: Available');
        }

        function showAlert(type, message) {
            const alert = document.getElementById('system-alert');
            alert.className = `alert alert-${type}`;
            alert.querySelector('span:last-child').textContent = message;
            alert.style.display = 'flex';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        function logMessage(message) {
            const output = document.getElementById('training-output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }

        // Organizational Training Dataset - From qwen_lora_trainer.py
        let organizationalTrainingExamples = [
            {
                id: 'digital_transformation',
                name: 'Digital Transformation Strategy',
                instruction: "What is our company's approach to digital transformation?",
                response: "Our digital transformation strategy focuses on customer-centric innovation, leveraging cloud-first architecture and data-driven decision making. We prioritize agile methodologies and cross-functional collaboration to deliver scalable solutions that enhance operational efficiency while maintaining our commitment to excellence and sustainable growth.",
                category: 'strategy',
                size: '1.2 KB'
            },
            {
                id: 'merger_opportunity',
                name: 'Merger Opportunity Assessment',
                instruction: "How should we handle a potential merger opportunity?",
                input: "A competitor has approached us about a potential merger.",
                response: "We should conduct thorough due diligence focusing on strategic fit, cultural alignment, and synergy potential. Our evaluation framework includes financial analysis, market positioning assessment, and integration complexity review. We'll engage our board early and ensure transparency with stakeholders while maintaining confidentiality throughout the process.",
                category: 'strategic_decisions',
                size: '1.8 KB'
            },
            {
                id: 'core_values',
                name: 'Core Values in Practice',
                instruction: "What are our core values in practice?",
                response: "Our core values manifest through customer obsession, operational excellence, and team empowerment. We demonstrate integrity in every decision, embrace innovation as a growth driver, and maintain accountability at all levels. These values guide our hiring, promotion, and strategic decisions, ensuring consistent culture across all business units.",
                category: 'culture',
                size: '1.1 KB'
            },
            {
                id: 'risk_management',
                name: 'Risk Management Framework',
                instruction: "How do we approach risk management?",
                input: "We're considering expanding into a new market segment.",
                response: "Our risk management framework balances opportunity assessment with prudent controls. We conduct comprehensive market analysis, pilot programs, and scenario planning. Key considerations include regulatory compliance, competitive landscape, resource allocation, and potential impact on existing operations. We maintain clear escalation procedures and regular risk review cycles.",
                category: 'risk_strategy',
                size: '1.5 KB'
            },
            {
                id: 'talent_development',
                name: 'Talent Development Philosophy',
                instruction: "What is our talent development philosophy?",
                response: "We believe in developing talent through challenging assignments, mentorship programs, and continuous learning opportunities. Our approach includes 360-degree feedback, cross-functional rotations, and leadership development tracks. We invest in both technical skills and leadership capabilities, fostering a culture of growth mindset and knowledge sharing.",
                category: 'hr_strategy',
                size: '1.3 KB'
            },
            {
                id: 'strategic_priorities',
                name: 'Strategic Initiative Prioritization',
                instruction: "How do we prioritize strategic initiatives?",
                input: "We have multiple competing priorities for the next quarter.",
                response: "Our prioritization framework evaluates initiatives based on strategic alignment, resource requirements, expected ROI, and implementation timeline. We use a scoring matrix considering customer impact, competitive advantage, and organizational capability. Regular reviews ensure agility in responding to market changes while maintaining focus on long-term objectives.",
                category: 'planning',
                size: '1.6 KB'
            },
            {
                id: 'crisis_management',
                name: 'Crisis Management Protocol',
                instruction: "What is our crisis management protocol?",
                input: "We're facing a potential PR crisis.",
                response: "Immediate activation of our crisis response team with clear communication channels and decision authority. Priority one is ensuring stakeholder safety and business continuity. We follow established communication protocols with transparent, timely updates to customers, employees, and partners. Post-crisis analysis includes lessons learned and process improvements.",
                category: 'crisis_response',
                size: '1.4 KB'
            },
            {
                id: 'innovation_culture',
                name: 'Innovation Foster Framework',
                instruction: "How do we foster innovation?",
                response: "Innovation thrives through dedicated time allocation, cross-team collaboration, and failure tolerance. We support experimentation with allocated resources, encourage diverse perspectives, and maintain open innovation channels. Regular innovation sessions, external partnerships, and customer feedback loops drive continuous improvement and breakthrough thinking.",
                category: 'innovation',
                size: '1.2 KB'
            }
        ];

        function loadWellnessRobertsDocuments() {
            const container = document.getElementById('wellnessroberts-documents');
            container.innerHTML = '';

            organizationalTrainingExamples.forEach(example => {
                const docElement = document.createElement('div');
                docElement.style.cssText = `
                    border: 1px solid var(--border-color);
                    border-radius: 6px;
                    padding: 0.75rem;
                    cursor: pointer;
                    transition: all 0.2s;
                    background: white;
                `;
                docElement.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.25rem;">
                                ${example.name}
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                                ${example.instruction} ${example.input ? '‚Ä¢ ' + example.input : ''}
                            </div>
                            <div style="font-size: 0.8rem; color: var(--secondary-color);">
                                ${example.size} ‚Ä¢ ${example.category} ‚Ä¢ Training Example
                            </div>
                        </div>
                        <button class="btn btn-accent" onclick="addOrganizationalExample('${example.id}')" style="margin-left: 0.5rem; padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                            Add
                        </button>
                    </div>
                `;

                docElement.onmouseover = () => {
                    docElement.style.borderColor = 'var(--accent-color)';
                    docElement.style.background = 'var(--bg-color)';
                };
                docElement.onmouseout = () => {
                    docElement.style.borderColor = 'var(--border-color)';
                    docElement.style.background = 'white';
                };

                container.appendChild(docElement);
            });

            logMessage(`‚úÖ Loaded ${organizationalTrainingExamples.length} organizational training examples`);
        }

        function addOrganizationalExample(exampleId) {
            try {
                logMessage(`üìÑ Adding organizational training example: ${exampleId}`);

                // Find the example info
                const example = organizationalTrainingExamples.find(ex => ex.id === exampleId);

                if (example) {
                    // Check if example is already added
                    if (!uploadedDocuments.find(doc => doc.name === example.name)) {
                        // Add to uploadedDocuments array so "Process Documents" button works
                        uploadedDocuments.push({
                            name: example.name,
                            size: example.size || '1.2 KB',
                            type: 'organizational_training',
                            uploaded: new Date().toISOString(),
                            training_examples: 1,
                            category: example.category,
                            instruction: example.instruction,
                            response: example.response
                        });

                        // Update the document list UI
                        updateDocumentList();

                        logMessage(`‚úÖ Training example added: "${example.name}"`);
                        logMessage(`üéØ Category: ${example.category}`);
                        logMessage(`üìù Instruction: ${example.instruction}`);
                    } else {
                        logMessage(`‚ÑπÔ∏è Training example "${example.name}" already added`);
                    }
                }

                updateDocumentCount();
            } catch (error) {
                logMessage(`‚ùå Error adding training example: ${error.message}`);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateDocumentCount();
            document.getElementById('system-status').className = 'status-indicator active';

            // Initialize model display with all metrics
            const defaultModel = modelConfigs[selectedBaseModel];
            document.getElementById('model-size').textContent = defaultModel.size;
            document.getElementById('build-time').textContent = defaultModel.buildTime;
            document.getElementById('inference-time').textContent = defaultModel.inferenceTime;
            document.getElementById('memory-usage').textContent = defaultModel.memoryUsage;

            logMessage('üöÄ Local Model Fine-Tuning Demo ready');
            logMessage(`ü§ñ Default model: ${defaultModel.name} (${defaultModel.params} parameters)`);
            logMessage(`‚ö° Performance: ${defaultModel.buildTime} build | ${defaultModel.inferenceTime} inference | ${defaultModel.memoryUsage} memory`);
            logMessage('üìã Use the dropdown to compare Llama 2 13B, Mistral 7B, and Qwen 2.5 3B');
            logMessage('üìÑ Load the prepared organizational training examples to see the difference');
            logMessage('üí° Fine-tune any model with your organizational data for customized AI responses');
            logMessage('‚ö†Ô∏è Note: This demo uses simulated responses. Real deployment would run actual LLMs via Ollama.');
        });
    </script>
</body>
</html>